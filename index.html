<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="theme-color" content="#1e5d54">
  <title>ç´è¥¿è˜­å—å³¶ 2026</title>
  <style>
    :root {
      --primary: #2a7c6f;
      --primary-dark: #1e5d54;
      --primary-light: #e6f2ef;
      --accent: #c8956c;
      --accent-light: #fdf0e5;
      --bg: #f5f4f1;
      --surface: #ffffff;
      --text: #1c2b28;
      --text-2: #5f7672;
      --text-3: #94a5a1;
      --border: #e4e8e7;
      --shadow: 0 1px 3px rgba(0,0,0,0.06);
      --shadow-md: 0 4px 12px rgba(0,0,0,0.08);
      --r: 10px;
      --r-sm: 7px;
      --font: "PingFang TC","Noto Sans TC","Microsoft JhengHei",-apple-system,sans-serif;
      --type-æ™¯é»: #2a7c6f; --type-æ™¯é»-bg: #e6f2ef;
      --type-åƒå–: #c8956c; --type-åƒå–-bg: #fdf0e5;
      --type-ç§»å‹•: #6889a0; --type-ç§»å‹•-bg: #e8f0f5;
      --type-ä½œæ¥­: #8b7da8; --type-ä½œæ¥­-bg: #eeeaf5;
      --type-ä½å®¿: #a08060; --type-ä½å®¿-bg: #f5efe8;
    }
    *{box-sizing:border-box;margin:0;padding:0}
    html{scroll-behavior:smooth;-webkit-tap-highlight-color:transparent}
    body{font-family:var(--font);background:var(--bg);color:var(--text);line-height:1.6;-webkit-font-smoothing:antialiased;overflow-x:hidden}
    a{color:var(--primary);text-decoration:none}

    /* ===== Header ===== */
    .header{background:linear-gradient(135deg,#1a4f47,#2a7c6f 40%,#3a9888);color:#fff;padding:2.5rem 1.5rem 2rem;text-align:center;position:relative}
    .header::after{content:'';position:absolute;bottom:-1px;left:0;right:0;height:14px;background:var(--bg);border-radius:14px 14px 0 0}
    .header h1{font-size:1.4rem;font-weight:700;letter-spacing:.04em;margin-bottom:.2rem}
    .header .sub{font-size:.8rem;opacity:.8;margin-bottom:.5rem}
    .header .badges{display:flex;justify-content:center;gap:.5rem;flex-wrap:wrap}
    .header .hbadge{display:inline-flex;align-items:center;gap:.25rem;background:rgba(255,255,255,.18);padding:.2rem .7rem;border-radius:20px;font-size:.72rem;backdrop-filter:blur(4px)}

    /* ===== Tabs ===== */
    .tabs{display:flex;background:var(--surface);border-bottom:1px solid var(--border);position:sticky;top:0;z-index:100}
    .tab{flex:1;text-align:center;padding:.7rem 0 .6rem;font-size:.78rem;font-weight:500;color:var(--text-2);cursor:pointer;border-bottom:2.5px solid transparent;transition:all .2s;user-select:none}
    .tab.on{color:var(--primary);border-bottom-color:var(--primary);font-weight:600}
    .tab .ti{font-size:1rem;display:block;margin-bottom:.1rem}

    /* ===== Day Selector ===== */
    .day-sel{display:flex;gap:.4rem;padding:.6rem .8rem;overflow-x:auto;background:var(--surface);border-bottom:1px solid var(--border);position:sticky;top:49px;z-index:90;-webkit-overflow-scrolling:touch;scrollbar-width:none}
    .day-sel::-webkit-scrollbar{display:none}
    .dp{flex-shrink:0;padding:.3rem .65rem;border-radius:18px;font-size:.72rem;cursor:pointer;background:var(--bg);color:var(--text-2);border:1px solid var(--border);transition:all .2s;text-align:center;min-width:44px;user-select:none;line-height:1.4}
    .dp.on{background:var(--primary);color:#fff;border-color:var(--primary);font-weight:600}
    .dp .dd{font-weight:500;font-size:.73rem}
    .dp .dw{font-size:.62rem;opacity:.7}

    /* ===== Content ===== */
    .ct{padding:1rem;max-width:640px;margin:0 auto;padding-bottom:3rem}

    /* ===== Day Header ===== */
    .dh h2{font-size:1.2rem;font-weight:700;margin-bottom:.15rem;line-height:1.3}
    .dh .ddate{font-size:.8rem;color:var(--text-2);margin-bottom:.75rem}

    /* ===== Stats ===== */
    .stats{display:flex;gap:.5rem;flex-wrap:wrap;margin-bottom:.75rem}
    .st{display:inline-flex;align-items:center;gap:.25rem;padding:.25rem .55rem;background:var(--primary-light);color:var(--primary-dark);border-radius:5px;font-size:.72rem;font-weight:500}

    /* ===== Drive Note ===== */
    .dnote{background:#fef9ef;border-left:3px solid var(--accent);padding:.45rem .7rem;margin-bottom:.85rem;font-size:.78rem;border-radius:0 6px 6px 0;color:#7a6540}

    /* ===== Map Section ===== */
    .map-sec{margin-bottom:.85rem;border-radius:var(--r-sm);overflow:hidden;background:var(--surface);box-shadow:var(--shadow)}
    .map-tog{display:flex;align-items:center;gap:.4rem;padding:.6rem .75rem;font-size:.82rem;color:var(--primary);cursor:pointer;font-weight:500;user-select:none}
    .map-tog svg{transition:transform .3s;flex-shrink:0}
    .map-sec.open .map-tog svg{transform:rotate(180deg)}
    .map-fr{height:0;overflow:hidden;transition:height .35s ease}
    .map-sec.open .map-fr{height:280px}
    .map-fr iframe{width:100%;height:280px;border:0;border-top:1px solid var(--border)}
    .map-open-btn{display:inline-flex;align-items:center;gap:.25rem;margin-left:auto;padding:.15rem .5rem;background:var(--primary-light);border-radius:4px;font-size:.7rem;color:var(--primary);text-decoration:none;flex-shrink:0}

    /* ===== Timeline ===== */
    .tl{position:relative;padding-left:1.6rem;margin-bottom:1rem}
    .tl::before{content:'';position:absolute;left:5px;top:8px;bottom:8px;width:2px;background:var(--border);border-radius:1px}

    /* ===== Activity Card ===== */
    .ac{position:relative;background:var(--surface);border-radius:var(--r-sm);box-shadow:var(--shadow);margin-bottom:.6rem;overflow:hidden}
    .ac::before{content:'';position:absolute;left:-1.6rem;top:.85rem;width:10px;height:10px;border-radius:50%;border:2px solid var(--surface);z-index:1;transform:translateX(-1px)}
    .ac[data-t="æ™¯é»"]::before{background:var(--type-æ™¯é»)}
    .ac[data-t="åƒå–"]::before{background:var(--type-åƒå–)}
    .ac[data-t="ç§»å‹•"]::before{background:var(--type-ç§»å‹•)}
    .ac[data-t="ä½œæ¥­"]::before{background:var(--type-ä½œæ¥­)}
    .ac[data-t="ä½å®¿"]::before{background:var(--type-ä½å®¿)}

    .ah{display:flex;flex-wrap:wrap;align-items:center;padding:.55rem .7rem .45rem;cursor:pointer;gap:.3rem .45rem;-webkit-tap-highlight-color:transparent}
    .ah-top{display:flex;align-items:center;gap:.45rem;width:100%;min-width:0}
    .an{flex:1;font-size:.88rem;font-weight:500;line-height:1.35;min-width:0;overflow:hidden;text-overflow:ellipsis}
    .ah-sub{display:flex;align-items:center;gap:.6rem;width:100%;padding-left:calc(.35rem + .7rem + .45rem);font-size:.72rem;color:var(--text-3);line-height:1.3}
    .ah-sub span{display:inline-flex;align-items:center;gap:.2rem;white-space:nowrap}
    .ah-drive{display:flex;align-items:center;gap:.3rem;padding:.2rem .7rem 0;font-size:.68rem;color:var(--type-ç§»å‹•);opacity:.8}
    .ab{flex-shrink:0;padding:.12rem .35rem;border-radius:3px;font-size:.6rem;font-weight:700;letter-spacing:.02em;text-transform:uppercase}
    .ab-æ™¯é»{background:var(--type-æ™¯é»-bg);color:var(--type-æ™¯é»)}
    .ab-åƒå–{background:var(--type-åƒå–-bg);color:var(--type-åƒå–)}
    .ab-ç§»å‹•{background:var(--type-ç§»å‹•-bg);color:var(--type-ç§»å‹•)}
    .ab-ä½œæ¥­{background:var(--type-ä½œæ¥­-bg);color:var(--type-ä½œæ¥­)}
    .ab-ä½å®¿{background:var(--type-ä½å®¿-bg);color:var(--type-ä½å®¿)}
    .chev{flex-shrink:0;width:18px;height:18px;transition:transform .3s;color:var(--text-3)}
    .ac.ex .chev{transform:rotate(180deg)}

    /* Details */
    .ad{max-height:0;overflow:hidden;transition:max-height .3s ease-out}
    .ac.ex .ad{max-height:500px;transition:max-height .4s ease-in}
    .adi{padding:0 .7rem .7rem;border-top:1px solid var(--border)}
    .dr{display:flex;align-items:flex-start;gap:.4rem;margin-top:.45rem;font-size:.78rem;color:var(--text-2)}
    .dl{font-weight:600;color:var(--text);min-width:40px;flex-shrink:0;font-size:.75rem}
    .dv{flex:1}
    .ftags{display:flex;gap:.3rem;flex-wrap:wrap;margin-top:.3rem}
    .ftag{display:inline-flex;align-items:center;gap:.15rem;padding:.1rem .35rem;background:#f0f1f0;border-radius:3px;font-size:.68rem}
    .nwarn{background:#fef9ef;border-left:2px solid var(--accent);padding:.3rem .5rem;margin-top:.4rem;border-radius:0 4px 4px 0;font-size:.75rem;color:#7a6540}
    .ntodo{background:#fff4e5;border-left:2px solid #f59e0b;padding:.3rem .5rem;margin-top:.4rem;border-radius:0 4px 4px 0;font-size:.75rem;color:#92600a}
    .mlink{display:inline-flex;align-items:center;gap:.25rem;padding:.2rem .5rem;background:var(--primary-light);color:var(--primary);border-radius:4px;font-size:.72rem;margin-top:.4rem;transition:background .2s}
    .mlink:hover{background:#d4ebe5}

    /* ===== Accommodation ===== */
    .acard{background:var(--surface);border-radius:var(--r-sm);box-shadow:var(--shadow);margin-top:.6rem;margin-bottom:.85rem;overflow:hidden}
    .acard-h{display:flex;align-items:center;gap:.5rem;padding:.6rem .7rem;cursor:pointer;-webkit-tap-highlight-color:transparent}
    .acard-h .ai{font-size:1.2rem;flex-shrink:0}
    .acard-h h3{flex:1;font-size:.88rem;font-weight:500;line-height:1.3}
    .acard .chev{flex-shrink:0;width:18px;height:18px;transition:transform .3s;color:var(--text-3)}
    .acard.ex .chev{transform:rotate(180deg)}
    .acard-d{max-height:0;overflow:hidden;transition:max-height .3s ease-out}
    .acard.ex .acard-d{max-height:400px;transition:max-height .4s ease-in}
    .acard-di{padding:0 .7rem .7rem;border-top:1px solid var(--border)}
    .aprice{color:var(--accent);font-weight:600;font-size:.82rem}
    .acard-di p{font-size:.78rem;color:var(--text-2);margin-top:.3rem}

    /* ===== Cancelled ===== */
    .cxs{margin-top:.6rem}
    .cxt{display:flex;align-items:center;gap:.4rem;padding:.4rem 0;cursor:pointer;font-size:.78rem;color:var(--text-3);user-select:none}
    .cxt svg{transition:transform .3s}
    .cxs.open .cxt svg{transform:rotate(180deg)}
    .cxi{display:none}
    .cxs.open .cxi{display:block}
    .cxc{background:#f5f5f5;border-radius:var(--r-sm);padding:.45rem .65rem;margin-bottom:.4rem;opacity:.55}
    .cxc .an{text-decoration:line-through;color:var(--text-3);font-size:.82rem}
    .cxc .cn{font-size:.7rem;color:var(--text-3);margin-top:.15rem}

    /* ===== Flights ===== */
    .fc{background:var(--surface);border-radius:var(--r);box-shadow:var(--shadow);margin-bottom:1rem;overflow:hidden}
    .fch{background:var(--primary-light);padding:.65rem .85rem;font-weight:600;color:var(--primary-dark);font-size:.9rem}
    .fdir{padding:.4rem .85rem;font-size:.75rem;color:var(--text-2);border-bottom:1px solid var(--border);font-weight:500;background:#fafafa}
    .fl{display:flex;align-items:center;padding:.55rem .85rem;border-bottom:1px solid var(--border);gap:.6rem}
    .fl:last-child{border-bottom:none}
    .fe{font-size:1.1rem;flex-shrink:0}
    .fi{flex:1}
    .fr{font-size:.82rem;font-weight:500}
    .fd{font-size:.72rem;color:var(--text-2)}
    .ftr{font-size:.72rem;color:var(--accent);padding:.35rem .85rem;background:var(--accent-light)}
    .fcost{padding:.65rem .85rem;background:var(--accent-light);font-size:.82rem;color:#8a6840;font-weight:500}

    /* ===== Packing List ===== */
    .clprog{background:var(--border);border-radius:10px;height:6px;margin-bottom:1rem;overflow:hidden}
    .clbar{background:var(--primary);height:100%;border-radius:10px;transition:width .3s}
    .plcat{margin-bottom:.7rem;background:var(--surface);border-radius:var(--r-sm);box-shadow:var(--shadow);overflow:hidden}
    .plch{display:flex;align-items:center;gap:.4rem;padding:.55rem .7rem;cursor:pointer;user-select:none;border-bottom:1px solid var(--border)}
    .plcat.closed .plch{border-bottom:none}
    .plci{font-size:1rem;flex-shrink:0}
    .plcn{flex:1;font-size:.85rem;font-weight:600}
    .plcc{font-size:.68rem;color:var(--text-3);padding:.1rem .4rem;background:var(--bg);border-radius:10px}
    .plcat .chev{flex-shrink:0;width:16px;height:16px;transition:transform .3s;color:var(--text-3)}
    .plcat.closed .chev{transform:rotate(-90deg)}
    .plcat.closed .plcl{display:none}
    .pltag{font-size:.58rem;padding:.08rem .3rem;border-radius:3px;background:#e8d5f5;color:#7b4ea0;font-weight:500;flex-shrink:0}
    .cli{display:flex;align-items:center;gap:.65rem;padding:.5rem .7rem;cursor:pointer;transition:opacity .2s;user-select:none;border-bottom:1px solid var(--border)}
    .cli:last-child{border-bottom:none}
    .cli.ck{opacity:.45}
    .cli.ck .cltx{text-decoration:line-through}
    .clcb{width:18px;height:18px;border:2px solid var(--border);border-radius:4px;display:flex;align-items:center;justify-content:center;flex-shrink:0;transition:all .2s;font-size:.65rem;color:transparent}
    .cli.ck .clcb{background:var(--primary);border-color:var(--primary);color:#fff}
    .cltx{font-size:.82rem;flex:1}

    /* ===== Notes ===== */
    .nt-day{background:var(--surface);border-radius:var(--r-sm);box-shadow:var(--shadow);padding:.6rem .7rem;margin-bottom:.85rem}
    .nt-lbl{font-size:.78rem;font-weight:500;color:var(--text-2);margin-bottom:.3rem;display:flex;align-items:center;gap:.3rem}
    .nt-input{width:100%;border:1px solid var(--border);border-radius:6px;padding:.4rem .55rem;font-size:.78rem;font-family:var(--font);resize:vertical;min-height:2.4rem;background:var(--surface);color:var(--text);line-height:1.5}
    .nt-input:focus{outline:none;border-color:var(--primary);box-shadow:0 0 0 2px rgba(42,124,111,.15)}
    .nt-input::placeholder{color:var(--text-3)}
    .nt-card{margin-top:.45rem;padding-top:.35rem;border-top:1px dashed var(--border)}
    .adi>.nt-card:first-child{border-top:none;margin-top:0;padding-top:.1rem}
    .nt-card .nt-input{min-height:2rem;font-size:.75rem}
    .nt-dot{width:6px;height:6px;border-radius:50%;background:var(--accent);flex-shrink:0;margin-left:-.2rem}

    /* ===== Tips ===== */
    .tc{background:var(--surface);border-radius:var(--r-sm);box-shadow:var(--shadow);padding:.85rem;margin-bottom:.65rem}
    .tc h3{font-size:.9rem;font-weight:600;margin-bottom:.4rem;display:flex;align-items:center;gap:.4rem}
    .tc ul{padding-left:1.1rem;font-size:.82rem;color:var(--text-2)}
    .tc li{margin-bottom:.3rem}
    .tc .tv{font-size:.82rem;color:var(--text-2)}
    .twarn{background:#fef0f0;border-left:3px solid #e74c3c;padding:.45rem .65rem;border-radius:0 6px 6px 0;margin-top:.4rem;font-size:.78rem;color:#7a2020}

    /* ===== Section Title ===== */
    .stitle{font-size:1.15rem;font-weight:700;margin-bottom:.85rem;display:flex;align-items:center;gap:.4rem}

    /* ===== Footer ===== */
    .footer{text-align:center;padding:1.5rem;font-size:.72rem;color:var(--text-3)}

    /* ===== Responsive ===== */
    @media(min-width:768px){
      .ct{padding:1.5rem}
      .header{padding:3rem 2rem 2.2rem}
      .header h1{font-size:1.6rem}
    }

    /* ===== Animation ===== */
    @keyframes fadeIn{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}
    .ct{animation:fadeIn .3s ease-out}
  </style>
</head>
<body>
  <div id="app">
    <div style="padding:3rem;text-align:center;color:var(--text-2)">è¼‰å…¥ä¸­...</div>
  </div>

  <script src="data.js"></script>
  <script>
  (function(){
    // ===== State =====
    const S = {
      tab: 'itin',
      day: getAutoDay(),
      exp: new Set(),
      cl: loadCL(),
      cc: new Set(),
      nt: loadNT()
    };

    function getAutoDay(){
      const d = Math.floor((new Date()-new Date('2026-02-13'))/864e5);
      return d>=0&&d<=18?d:1;
    }
    function loadCL(){try{return JSON.parse(localStorage.getItem('nz26pk')||'{}')}catch(e){return{}}}
    function saveCL(){localStorage.setItem('nz26pk',JSON.stringify(S.cl))}
    function loadNT(){try{return JSON.parse(localStorage.getItem('nz26nt')||'{}')}catch(e){return{}}}
    function saveNT(){localStorage.setItem('nz26nt',JSON.stringify(S.nt))}

    const FICON = {'åœè»Šå ´':'ğŸ…¿ï¸','å»æ‰€':'ğŸš»','è·¯é‚Šåœè»Š':'ğŸš—','ä»˜è²»å»æ‰€':'ğŸ’°'};
    const GMAP_URL = 'https://www.google.com/maps/d/u/0/viewer?mid=1I-Tn1fN0KJmqLi_xYKibtde2L8Gn2lo';

    // ===== Render =====
    function render(){
      const app = document.getElementById('app');
      app.innerHTML = renderHeader() + renderTabs() + '<div id="ct">' + renderContent() + '</div>';
      if(S.tab==='itin') raf(scrollDay);
    }

    function renderHeader(){
      return `<div class="header">
        <h1>ğŸ‡³ğŸ‡¿ ç´è¥¿è˜­å—å³¶ 2026</h1>
        <div class="sub">${DATA.duration}</div>
        <div class="badges">
          <span class="hbadge">ğŸ§­ ${DATA.tripType}è·¯ç·š</span>
          <span class="hbadge">ğŸš éœ²ç‡Ÿè»Šè‡ªé§•</span>
          <span class="hbadge">ğŸ‘¥ 4äºº</span>
        </div>
      </div>`;
    }

    function renderTabs(){
      const tabs = [
        {k:'itin',i:'ğŸ—“',l:'è¡Œç¨‹'},
        {k:'flights',i:'âœˆï¸',l:'èˆªç­'},
        {k:'check',i:'ğŸ§³',l:'è¡Œæ'},
        {k:'tips',i:'ğŸ“‹',l:'é ˆçŸ¥'}
      ];
      return `<div class="tabs">${tabs.map(t=>
        `<div class="tab${S.tab===t.k?' on':''}" data-a="tab" data-v="${t.k}">
          <span class="ti">${t.i}</span>${t.l}
        </div>`
      ).join('')}</div>`;
    }

    function renderContent(){
      switch(S.tab){
        case 'itin': return renderItin();
        case 'flights': return renderFlights();
        case 'check': return renderCheck();
        case 'tips': return renderTips();
      }
    }

    // ===== Itinerary =====
    function renderItin(){
      return renderDaySel() + '<div class="ct" id="dv">' + renderDayView() + '</div>';
    }

    function renderDaySel(){
      return `<div class="day-sel" id="ds">${DATA.days.map(d=>{
        const isF = d.day<=1||d.day>=17;
        return `<div class="dp${S.day===d.day?' on':''}" data-a="day" data-v="${d.day}">
          <div class="dd">${isF?'âœˆï¸ ':''}${d.date}</div>
          <div class="dw">${d.weekday}</div>
        </div>`;
      }).join('')}</div>`;
    }

    function renderDayView(){
      const d = DATA.days[S.day];
      if(!d) return '';
      const active = [];
      d.activities.forEach((a,i)=>{if(!a.cancelled) active.push({a:a,idx:i})});
      const cxd = d.activities.filter(a=>a.cancelled);
      const hasStats = d.km>0||(d.driveTime&&d.driveTime!=='0');

      return `<div class="dh">
        <h2>${d.title}</h2>
        <div class="ddate">${d.date} (${d.weekday}) Â· ç¬¬ ${d.day} å¤©</div>
      </div>
      ${hasStats?`<div class="stats">
        ${d.km>0?`<span class="st">ğŸš— ${d.km} km</span>`:''}
        ${d.driveTime&&d.driveTime!=='0'?`<span class="st">â± ${d.driveTime}</span>`:''}
        ${d.route?`<span class="st">ğŸ“ ${d.route}</span>`:''}
      </div>`:''}
      ${d.driveNotes?`<div class="dnote">ğŸ“Œ ${esc(d.driveNotes)}</div>`:''}
      <div class="map-sec" id="mapsec">
        <div class="map-tog" data-a="maptog">
          ğŸ—ºï¸ é¡¯ç¤ºè·¯ç·šåœ°åœ–
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"><polyline points="6 9 12 15 18 9"/></svg>
          <a class="map-open-btn" href="${GMAP_URL}" target="_blank" rel="noopener" onclick="event.stopPropagation()">é–‹å•Ÿå®Œæ•´åœ°åœ– â†—</a>
        </div>
        <div class="map-fr">
          <iframe src="https://www.google.com/maps/d/embed?mid=1I-Tn1fN0KJmqLi_xYKibtde2L8Gn2lo" allowfullscreen loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>
        </div>
      </div>
      <div class="tl">
        ${active.map(item=>renderAC(item.a,S.day+'-'+item.idx)).join('')}
      </div>
      ${cxd.length?renderCX(cxd):''}
      ${d.accommodation?renderAccom(d.accommodation,S.day):''}
      <div class="nt-day">
        <div class="nt-lbl">ğŸ“ ä»Šæ—¥å‚™è¨»</div>
        <textarea class="nt-input" data-nk="d${d.day}" placeholder="è¨˜éŒ„ä»Šå¤©çš„æƒ³æ³•...">${esc(S.nt['d'+d.day]||'')}</textarea>
      </div>`;
    }

    function renderAC(a,key){
      const isEx = S.exp.has(key);
      const sch = DATA.schedules&&DATA.schedules[key];
      const schTime = sch&&sch.s;
      const drv = sch&&sch.d;
      const isRange = schTime&&/^\d{2}:\d{2}-\d{2}:\d{2}/.test(schTime);
      const hasSub = schTime||a.time||drv;
      const noteVal = S.nt[key]||'';
      return `<div class="ac${isEx?' ex':''}" data-t="${a.type}" data-k="${key}">
        ${drv?`<div class="ah-drive">ğŸš— ${esc(drv)}</div>`:''}
        <div class="ah" data-a="tog" data-v="${key}">
          <div class="ah-top">
            <span class="ab ab-${a.type}">${a.type}</span>
            <span class="an">${esc(a.name)}</span>
            ${noteVal?'<span class="nt-dot"></span>':''}
            <svg class="chev" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"><polyline points="6 9 12 15 18 9"/></svg>
          </div>
          ${hasSub?`<div class="ah-sub">
            ${schTime?`<span>ğŸ“ ${esc(schTime)}${isRange&&a.time?' ('+esc(a.time)+')':''}</span>`:(a.time?`<span>â± ${esc(a.time)}</span>`:'')}
            ${!schTime&&a.hours?`<span>ğŸ• ${esc(a.hours)}</span>`:''}
          </div>`:''}
        </div>
        <div class="ad"><div class="adi">
          ${a.description?`<div class="dr"><span class="dl">èªªæ˜</span><span class="dv">${esc(a.description)}</span></div>`:''}
          ${a.hours?`<div class="dr"><span class="dl">${a.type==='ç§»å‹•'?'èˆªç­':'ç‡Ÿæ¥­'}</span><span class="dv">${esc(a.hours)}</span></div>`:''}
          ${a.facilities&&a.facilities.length?`<div class="dr"><span class="dl">è¨­æ–½</span><div class="ftags">${a.facilities.map(f=>`<span class="ftag">${FICON[f]||'ğŸ“'} ${esc(f)}</span>`).join('')}</div></div>`:''}
          ${a.notes?(a.notes.includes('TODO')?`<div class="ntodo">ğŸ“Œ ${esc(a.notes)}</div>`:`<div class="nwarn">${esc(a.notes)}</div>`):''}
          ${a.type!=='ç§»å‹•'?`<a class="mlink" href="${getMapUrl(a)}" target="_blank" rel="noopener">ğŸ“ Google Maps</a>`:''}
          <div class="nt-card">
            <textarea class="nt-input" data-nk="${key}" placeholder="ğŸ“ å¯«ä¸‹å‚™è¨»...">${esc(noteVal)}</textarea>
          </div>
        </div></div>
      </div>`;
    }

    function renderCX(items){
      return `<div class="cxs" id="cxs">
        <div class="cxt" data-a="cxtog">
          âŠ˜ å·²æ’é™¤æ™¯é» (${items.length})
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"><polyline points="6 9 12 15 18 9"/></svg>
        </div>
        <div class="cxi">${items.map(a=>`<div class="cxc">
          <div class="an">${esc(a.name)}</div>
          ${a.notes?`<div class="cn">${esc(a.notes)}</div>`:''}
        </div>`).join('')}</div>
      </div>`;
    }

    function renderAccom(acc,day){
      if(!acc.name) return '';
      const akey = 'acc-'+day;
      const isEx = S.exp.has(akey);
      const noteVal = S.nt[akey]||'';
      const isPlace = acc.name!=='é£›æ©Ÿä¸Š';
      const mapUrl = acc.mapLink || (isPlace?'https://www.google.com/maps/search/?api=1&query='+encodeURIComponent(acc.name+' New Zealand'):'');
      const icon = isPlace?'ğŸ ':'âœˆï¸';
      return `<div class="acard${isEx?' ex':''}">
        <div class="acard-h" data-a="tog" data-v="${akey}">
          <span class="ai">${icon}</span>
          <h3>${esc(acc.name)}</h3>
          ${noteVal?'<span class="nt-dot"></span>':''}
          <svg class="chev" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"><polyline points="6 9 12 15 18 9"/></svg>
        </div>
        <div class="acard-d"><div class="acard-di">
          ${acc.price?`<p class="aprice">ğŸ’° ${esc(acc.price)}</p>`:''}
          ${acc.notes?`<p>${esc(acc.notes)}</p>`:''}
          ${mapUrl?`<a class="mlink" href="${mapUrl}" target="_blank" rel="noopener">ğŸ“ Google Maps</a>`:''}
          <div class="nt-card">
            <textarea class="nt-input" data-nk="${akey}" placeholder="ğŸ“ ä½å®¿å‚™è¨»...">${esc(noteVal)}</textarea>
          </div>
        </div></div>
      </div>`;
    }

    // ===== Flights =====
    function renderFlights(){
      return `<div class="ct">
        <div class="stitle">âœˆï¸ èˆªç­è³‡è¨Š</div>
        ${renderFRoute('é«˜é›„ KHH å‡ºç™¼',DATA.flights.kaohsiung)}
        ${renderFRoute('æ¡ƒåœ’ TPE å‡ºç™¼',DATA.flights.taipei)}
      </div>`;
    }

    function renderFRoute(label,route){
      return `<div class="fc">
        <div class="fch">${label}</div>
        <div class="fdir">å»ç¨‹</div>
        ${route.outbound.map(renderFLeg).join('')}
        <div class="fdir">å›ç¨‹</div>
        ${route.inbound.map(renderFLeg).join('')}
        ${route.totalCost?`<div class="fcost">ğŸ’° ${route.totalCost}</div>`:''}
      </div>`;
    }

    function renderFLeg(leg){
      return `${leg.transit?`<div class="ftr">â³ è½‰æ©Ÿç­‰å€™ ${leg.transit}</div>`:''}
      <div class="fl">
        <div class="fe">âœˆï¸</div>
        <div class="fi">
          <div class="fr">${esc(leg.from)} â†’ ${esc(leg.to)}</div>
          <div class="fd">${leg.flight} Â· ${leg.depart} â†’ ${leg.arrive} Â· ${leg.duration}</div>
        </div>
      </div>`;
    }

    // ===== Packing List =====
    function renderCheck(){
      const pl = DATA.packingList;
      let total=0, done=0;
      pl.forEach((cat,ci)=>cat.items.forEach((_,ii)=>{total++;if(S.cl[ci+'-'+ii])done++}));
      const pct = total?Math.round(done/total*100):0;
      return `<div class="ct">
        <div class="stitle">ğŸ§³ è¡Œææ¸…å–®</div>
        <p style="font-size:.82rem;color:var(--text-2);margin-bottom:.75rem">${done}/${total} å·²æ‰“åŒ… (${pct}%)</p>
        <div class="clprog"><div class="clbar" style="width:${pct}%"></div></div>
        ${pl.map((cat,ci)=>{
          const catDone=cat.items.filter((_,ii)=>S.cl[ci+'-'+ii]).length;
          const closed=S.cc.has(ci);
          return `<div class="plcat${closed?' closed':''}">
            <div class="plch" data-a="cattog" data-v="${ci}">
              <span class="plci">${cat.icon}</span>
              <span class="plcn">${esc(cat.cat)}</span>
              ${cat.who?`<span class="pltag">${esc(cat.who)}</span>`:''}
              <span class="plcc">${catDone}/${cat.items.length}</span>
              <svg class="chev" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"><polyline points="6 9 12 15 18 9"/></svg>
            </div>
            <div class="plcl">${cat.items.map((item,ii)=>{
              const key=ci+'-'+ii;const ck=S.cl[key];
              return `<div class="cli${ck?' ck':''}" data-a="ck" data-v="${key}">
                <div class="clcb">${ck?'âœ“':''}</div>
                <span class="cltx">${esc(item.item)}</span>
                ${item.who?`<span class="pltag">${esc(item.who)}</span>`:''}
              </div>`;
            }).join('')}</div>
          </div>`;
        }).join('')}
      </div>`;
    }

    // ===== Tips =====
    function renderTips(){
      const dt = DATA.drivingTips;
      const tp = DATA.tips;
      return `<div class="ct">
        <div class="stitle">ğŸ“‹ è¡Œå‰é ˆçŸ¥</div>

        <div class="tc">
          <h3>ğŸš— é§•é§›é ˆçŸ¥</h3>
          <div class="nwarn" style="margin-bottom:.5rem">âš ï¸ ${esc(dt.note)}</div>
          <ul>
            <li>é§•é§›æ™‚é–“ï¼š${esc(dt.drivingHours)}</li>
            <li>é€Ÿé™ï¼šå…¬è·¯ ${dt.speedLimit.highway} / éœ²ç‡Ÿè»Š ${dt.speedLimit.campervan} / å°é® ${dt.speedLimit.town}</li>
            <li>æ¯æ—¥ç›®æ¨™ï¼š${esc(dt.dailyTarget)}</li>
            <li>å°èˆªæ™‚é–“ï¼šGoogle Maps Ã— ${esc(dt.timeMultiplier)}</li>
            <li>éœ²ç‡Ÿè»Šé•·ï¼š${dt.campervanLength}</li>
          </ul>
        </div>

        <div class="tc">
          <h3>ğŸ›£ï¸ é‡è¦è·¯ç·šæé†’</h3>
          <ul>${dt.importantRoutes.map(r=>`<li>${esc(r)}</li>`).join('')}</ul>
        </div>

        <div class="tc">
          <h3>ğŸš éœ²ç‡Ÿè»Šè³‡è¨Š</h3>
          <ul>
            <li>é ç´„ç·¨è™Ÿï¼š${tp.campervan.bookingRef}</li>
            <li>å–è»Š ${tp.campervan.pickupTime} / å‡ºç™¼ ${tp.campervan.departTime}</li>
            <li>è²»ç”¨ï¼š${tp.campervan.totalCost}</li>
            <li>è»Šé•·ï¼š${tp.campervan.length}</li>
          </ul>
        </div>

        <div class="tc">
          <h3>ğŸ›’ è¶…å¸‚æ¡è³¼</h3>
          <div class="tv">${esc(tp.supermarket)}</div>
        </div>

        ${tp.sandfly_warning?`<div class="tc">
          <h3>ğŸ¦Ÿ æ²™èšŠ(æ²™è …)è­¦å‘Š</h3>
          <div class="twarn">${esc(tp.sandfly_warning)}</div>
        </div>`:''}

        <div class="tc">
          <h3>ğŸ’± åŒ¯ç‡åƒè€ƒ</h3>
          <ul>
            <li>1 USD â‰ˆ ${DATA.currency.usd_to_twd} TWD</li>
            <li>1 NZD â‰ˆ ${DATA.currency.nzd_to_twd} TWD</li>
          </ul>
        </div>

        <div class="tc">
          <h3>ğŸ—ºï¸ è¡Œç¨‹åœ°åœ–</h3>
          <div class="tv">
            <a href="${GMAP_URL}" target="_blank" rel="noopener" class="mlink" style="margin-top:0">ğŸ“ åœ¨ Google Maps æŸ¥çœ‹å®Œæ•´è·¯ç·š</a>
          </div>
        </div>
      </div>`;
    }

    // ===== Events =====
    document.getElementById('app').addEventListener('click', function(e){
      const t = e.target.closest('[data-a]');
      if(!t) return;
      const a = t.dataset.a, v = t.dataset.v;

      if(a==='tab'){
        S.tab = v;
        S.exp.clear();
        render();
      }
      if(a==='day'){
        S.day = Number(v);
        S.exp.clear();
        document.querySelectorAll('.dp').forEach(p=>p.classList.toggle('on',Number(p.dataset.v)===S.day));
        const dv = document.getElementById('dv');
        if(dv) dv.innerHTML = renderDayView();
        raf(()=>{
          const dv2 = document.getElementById('dv');
          if(dv2) dv2.scrollIntoView({behavior:'smooth',block:'start'});
        });
      }
      if(a==='tog'){
        e.preventDefault();
        const key = v;
        const card = t.closest('.ac')||t.closest('.acard');
        if(S.exp.has(key)){S.exp.delete(key);card.classList.remove('ex')}
        else{S.exp.add(key);card.classList.add('ex')}
      }
      if(a==='maptog'){
        const sec = document.getElementById('mapsec');
        if(sec) sec.classList.toggle('open');
      }
      if(a==='cxtog'){
        const sec = t.closest('.cxs');
        if(sec) sec.classList.toggle('open');
      }
      if(a==='cattog'){
        const ci = Number(v);
        if(S.cc.has(ci)) S.cc.delete(ci); else S.cc.add(ci);
        const ct = document.getElementById('ct');
        if(ct) ct.innerHTML = renderContent();
      }
      if(a==='ck'){
        S.cl[v] = !S.cl[v];
        saveCL();
        const ct = document.getElementById('ct');
        if(ct) ct.innerHTML = renderContent();
      }
    });

    // ===== Note Input =====
    document.getElementById('app').addEventListener('input', function(e){
      if(e.target.classList.contains('nt-input')){
        const key = e.target.dataset.nk;
        if(key){S.nt[key]=e.target.value;saveNT()}
      }
    });

    // ===== Utils =====
    function getMapUrl(a){
      if(a.mapLink) return a.mapLink;
      const q = encodeURIComponent(a.name + ' New Zealand');
      return 'https://www.google.com/maps/search/?api=1&query=' + q;
    }
    function esc(s){
      if(!s) return '';
      return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');
    }
    function raf(fn){requestAnimationFrame(fn)}
    function scrollDay(){
      const el = document.querySelector('.dp.on');
      if(el) el.scrollIntoView({inline:'center',block:'nearest',behavior:'smooth'});
    }

    // ===== Init =====
    if(typeof DATA==='undefined'){
      document.getElementById('app').innerHTML='<p style="padding:3rem;text-align:center;color:var(--text-2)">âš ï¸ æ‰¾ä¸åˆ°è¡Œç¨‹è³‡æ–™ï¼Œè«‹ç¢ºèª data.js æª”æ¡ˆå­˜åœ¨</p>';
    } else {
      render();
    }
  })();
  </script>
</body>
</html>
